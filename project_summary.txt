# Сводка по проекту "Crypto Signal Bot" (Версия 2.0)

## Текущий статус (на 30.07.2025):
Бот полностью функционален и находится в режиме сбора статистики на реальном счете. Все критические баги, связанные с API Bybit (особенно ошибка `position idx not match position mode` для Единого Торгового Аккаунта), были успешно решены.

### Ключевые особенности архитектуры:
1.  **Тип аккаунта:** Система адаптирована для работы с **Единым Торговым Аккаунтом (UTA)** Bybit.
2.  **Открытие позиций:** Используется двухэтапная логика:
    *   **Этап 1:** Вход в рынок по **рыночному ордеру** с `positionIdx: 1` для лонга и `positionIdx: 2` для шорта.
    *   **Этап 2:** Установка SL/TP для уже открытой позиции отдельным запросом.
3.  **Риск-менеджмент (тройной контроль):**
    *   **Риск на сделку:** Не более **1%** от общего баланса.
    *   **Лимит маржи:** На одну сделку используется не более **20%** от общего баланса в качестве маржи.
    *   **Минимальный ордер:** Размер позиции автоматически корректируется, чтобы быть не меньше минимально допустимого.
4.  **Стратегия:**
    *   **Индикаторы:** EMA(100), RSI(14), ATR(14).
    *   **Сигнал:** Отклонение цены от EMA на >0.3%, отфильтрованное по RSI.
    *   **Риск/Прибыль:** Соотношение ~1:2.5 (SL = `2.0 * ATR`, TP = `5.0 * ATR`).
    *   **"Буфер безопасности" SL:** Стоп-лосс ставится на расстоянии, равном `max(2*ATR, 0.2% от цены)`, для защиты от проскальзывания на низковолатильных монетах.
5.  **Надежность:**
    *   **"Защитник" (`protector.py`):** Фоновый поток, который каждые 5 секунд проверяет все открытые позиции и устанавливает SL/TP, если они отсутствуют.

## План на следующую итерацию (через ~1 неделю):

1.  **Сбор данных:** Основная задача — дать боту поработать и совершить как можно больше сделок (цель: 50-100) для набора статистически значимых данных.
2.  **Анализ результатов:**
    *   Проанализировать общий PnL (прибыль/убыток).
    *   Рассчитать Профит-фактор и Win Rate (процент прибыльных сделок).
    *   Выявить самые прибыльные и самые убыточные монеты.
    *   Проверить, как часто цена не доходит до тейк-профита или слишком быстро выбивает стоп-лосс.
3.  **Оптимизация:** На основе анализа рассмотреть следующие возможные улучшения:
    *   Изменение параметров стратегии (окна EMA/RSI, порог отклонения).
    *   Корректировка множителей ATR для SL/TP.
    *   Формирование "черного" или "белого" списка монет.
    *   Добавление фильтров по времени (например, не торговать во время выхода новостей).
